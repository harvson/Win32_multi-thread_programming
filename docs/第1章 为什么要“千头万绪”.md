# 第一章 为什么要“千头万绪”

本章内容：

* <a href="#1_1_4">Win32基础</a>
* <a href="#1_1_5">Context Switching </a>

## <a name="#1_1_4">Win32基础</a>

### 进程

从 Win32 的角度来看，进程含有`内存`和`资源`。

### 资源

资源则包括:

* 核心对象 (如file handles 和线程）
* USER 资源（如对话框和字符串）
* GDI 资源（如 Device Context 和 brushes）

### 内存

内存可以大致分为三种类型：

* Code (程序的可执行部分，一定是只读（read only）性质。这是 CPU 唯一允许执行的内存。)
* Data (程序中的所有变量（不包括函数中的局部变量），可以区分为全局变量和静态变量两种)
* Stack (调用函数时所用的堆栈空间，其中有局部变量。每个线程产生 时配有一个堆栈。)

## <a name="#1_1_6">Context Switching </a>
在一个抢先式多任务系统中，当硬件计时器认为某个线程已经执行够久了，就会发出一个中断（interrupt），于是 CPU 取得目前这个线程的当前状态，也就是把所有寄存器内容拷贝到堆栈之中，再把它从堆栈拷贝到一个 CONTEXT 结构（这样便储存了线程的状态）中，以备以后再用。

要切换不同的线程，操作系统应先切换该线程所隶属之进程的内存（译 注），然后恢复该线程放在 CONTEXT 结构中的寄存器值。这整个过程便称为
`context switch`。

### 共享内存

不同进程间的线程如果要通讯，唯有依赖特别的设计，使之拥有`共享内存`（shared memory）。如果两个线程属于同一进程，它 们将共享所有的内存。 